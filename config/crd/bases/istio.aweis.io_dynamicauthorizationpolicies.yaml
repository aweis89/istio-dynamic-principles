---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.8.0
  creationTimestamp: null
  name: dynamicauthorizationpolicies.istio.aweis.io
spec:
  group: istio.aweis.io
  names:
    kind: DynamicAuthorizationPolicy
    listKind: DynamicAuthorizationPolicyList
    plural: dynamicauthorizationpolicies
    singular: dynamicauthorizationpolicy
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: DynamicAuthorizationPolicy is the Schema for the dynamicauthorizationpolicies
          API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: DynamicAuthorizationPolicySpec defines the desired state
              of DynamicAuthorizationPolicy
            properties:
              dynamicPrinciples:
                items:
                  properties:
                    name:
                      type: string
                    namespaceSelectors:
                      items:
                        properties:
                          matchLabels:
                            items:
                              additionalProperties:
                                type: string
                              type: object
                            type: array
                        required:
                        - matchLabels
                        type: object
                      type: array
                    podSelectors:
                      items:
                        properties:
                          matchLabels:
                            items:
                              additionalProperties:
                                type: string
                              type: object
                            type: array
                        required:
                        - matchLabels
                        type: object
                      type: array
                    trustDomain:
                      description: TrustDomain is the istio trust domain, defaults
                        to cluster.local
                      type: string
                  required:
                  - name
                  - namespaceSelectors
                  - podSelectors
                  - trustDomain
                  type: object
                type: array
              template:
                properties:
                  metadata:
                    type: object
                  spec:
                    description: Seme fields are missing json tags in securityv1beta1.AuthorizationPolicy
                    properties:
                      action:
                        description: Optional. The action to take if the request is
                          matched with the rules. Default is ALLOW if not specified.
                        format: int32
                        type: integer
                      rules:
                        items:
                          description: "Rule matches requests from a list of sources
                            that perform a list of operations subject to a list of
                            conditions. A match occurs when at least one source, one
                            operation and all conditions matches the request. An empty
                            rule is always matched. \n Any string field in the rule
                            supports Exact, Prefix, Suffix and Presence match: \n
                            - Exact match: \"abc\" will match on value \"abc\". -
                            Prefix match: \"abc*\" will match on value \"abc\" and
                            \"abcd\". - Suffix match: \"*abc\" will match on value
                            \"abc\" and \"xabc\". - Presence match: \"*\" will match
                            when value is not empty."
                          properties:
                            from:
                              description: "Optional. from specifies the source of
                                a request. \n If not set, any source is allowed."
                              items:
                                description: From includes a list or sources.
                                properties:
                                  source:
                                    description: Source specifies the source of a
                                      request.
                                    properties:
                                      ip_blocks:
                                        description: "Optional. A list of IP blocks,
                                          populated from the source address of the
                                          IP packet. Single IP (e.g. \"1.2.3.4\")
                                          and CIDR (e.g. \"1.2.3.0/24\") are supported.
                                          This is the same as the `source.ip` attribute.
                                          \n If not set, any IP is allowed."
                                        items:
                                          type: string
                                        type: array
                                      namespaces:
                                        description: "Optional. A list of namespaces
                                          derived from the peer certificate. This
                                          field requires mTLS enabled and is the same
                                          as the `source.namespace` attribute. \n
                                          If not set, any namespace is allowed."
                                        items:
                                          type: string
                                        type: array
                                      not_ip_blocks:
                                        description: Optional. A list of negative
                                          match of IP blocks.
                                        items:
                                          type: string
                                        type: array
                                      not_namespaces:
                                        description: Optional. A list of negative
                                          match of namespaces.
                                        items:
                                          type: string
                                        type: array
                                      not_principals:
                                        description: Optional. A list of negative
                                          match of peer identities.
                                        items:
                                          type: string
                                        type: array
                                      not_remote_ip_blocks:
                                        description: Optional. A list of negative
                                          match of remote IP blocks.
                                        items:
                                          type: string
                                        type: array
                                      not_request_principals:
                                        description: Optional. A list of negative
                                          match of request identities.
                                        items:
                                          type: string
                                        type: array
                                      principals:
                                        description: "Optional. A list of peer identities
                                          derived from the peer certificate. The peer
                                          identity is in the format of `\"<TRUST_DOMAIN>/ns/<NAMESPACE>/sa/<SERVICE_ACCOUNT>\"`,
                                          for example, `\"cluster.local/ns/default/sa/productpage\"`.
                                          This field requires mTLS enabled and is
                                          the same as the `source.principal` attribute.
                                          \n If not set, any principal is allowed."
                                        items:
                                          type: string
                                        type: array
                                      remote_ip_blocks:
                                        description: "Optional. A list of IP blocks,
                                          populated from X-Forwarded-For header or
                                          proxy protocol. To make use of this field,
                                          you must configure the numTrustedProxies
                                          field of the gatewayTopology under the meshConfig
                                          when you install Istio or using an annotation
                                          on the ingress gateway.  See the documentation
                                          here: [Configuring Gateway Network Topology](https://istio.io/latest/docs/ops/configuration/traffic-management/network-topologies/).
                                          Single IP (e.g. \"1.2.3.4\") and CIDR (e.g.
                                          \"1.2.3.0/24\") are supported. This is the
                                          same as the `remote.ip` attribute. \n If
                                          not set, any IP is allowed."
                                        items:
                                          type: string
                                        type: array
                                      request_principals:
                                        description: "Optional. A list of request
                                          identities derived from the JWT. The request
                                          identity is in the format of `\"<ISS>/<SUB>\"`,
                                          for example, `\"example.com/sub-1\"`. This
                                          field requires request authentication enabled
                                          and is the same as the `request.auth.principal`
                                          attribute. \n If not set, any request principal
                                          is allowed."
                                        items:
                                          type: string
                                        type: array
                                    type: object
                                type: object
                              type: array
                            to:
                              description: "Optional. to specifies the operation of
                                a request. \n If not set, any operation is allowed."
                              items:
                                description: To includes a list or operations.
                                properties:
                                  operation:
                                    description: Operation specifies the operation
                                      of a request.
                                    properties:
                                      hosts:
                                        description: "Optional. A list of hosts as
                                          specified in the HTTP request. The match
                                          is case-insensitive. See the [security best
                                          practices](https://istio.io/latest/docs/ops/best-practices/security/#writing-host-match-policies)
                                          for recommended usage of this field. \n
                                          If not set, any host is allowed. Must be
                                          used only with HTTP."
                                        items:
                                          type: string
                                        type: array
                                      methods:
                                        description: "Optional. A list of methods
                                          as specified in the HTTP request. For gRPC
                                          service, this will always be \"POST\". \n
                                          If not set, any method is allowed. Must
                                          be used only with HTTP."
                                        items:
                                          type: string
                                        type: array
                                      not_hosts:
                                        description: Optional. A list of negative
                                          match of hosts as specified in the HTTP
                                          request. The match is case-insensitive.
                                        items:
                                          type: string
                                        type: array
                                      not_methods:
                                        description: Optional. A list of negative
                                          match of methods as specified in the HTTP
                                          request.
                                        items:
                                          type: string
                                        type: array
                                      not_paths:
                                        description: Optional. A list of negative
                                          match of paths.
                                        items:
                                          type: string
                                        type: array
                                      not_ports:
                                        description: Optional. A list of negative
                                          match of ports as specified in the connection.
                                        items:
                                          type: string
                                        type: array
                                      paths:
                                        description: "Optional. A list of paths as
                                          specified in the HTTP request. See the [Authorization
                                          Policy Normalization](https://istio.io/latest/docs/reference/config/security/normalization/)
                                          for details of the path normalization. For
                                          gRPC service, this will be the fully-qualified
                                          name in the form of \"/package.service/method\".
                                          \n If not set, any path is allowed. Must
                                          be used only with HTTP."
                                        items:
                                          type: string
                                        type: array
                                      ports:
                                        description: "Optional. A list of ports as
                                          specified in the connection. \n If not set,
                                          any port is allowed."
                                        items:
                                          type: string
                                        type: array
                                    type: object
                                type: object
                              type: array
                            when:
                              description: "Optional. when specifies a list of additional
                                conditions of a request. \n If not set, any condition
                                is allowed."
                              items:
                                description: Condition specifies additional required
                                  attributes.
                                properties:
                                  key:
                                    description: The name of an Istio attribute. See
                                      the [full list of supported attributes](https://istio.io/docs/reference/config/security/conditions/).
                                    type: string
                                  not_values:
                                    description: 'Optional. A list of negative match
                                      of values for the attribute. Note: at least
                                      one of values or not_values must be set.'
                                    items:
                                      type: string
                                    type: array
                                  values:
                                    description: 'Optional. A list of allowed values
                                      for the attribute. Note: at least one of values
                                      or not_values must be set.'
                                    items:
                                      type: string
                                    type: array
                                type: object
                              type: array
                          type: object
                        type: array
                      selector:
                        description: WorkloadSelector specifies the criteria used
                          to determine if a policy can be applied to a proxy. The
                          matching criteria includes the metadata associated with
                          a proxy, workload instance info such as labels attached
                          to the pod/VM, or any other info that the proxy provides
                          to Istio during the initial handshake. If multiple conditions
                          are specified, all conditions need to match in order for
                          the workload instance to be selected. Currently, only label
                          based selection mechanism is supported.
                        properties:
                          match_labels:
                            additionalProperties:
                              type: string
                            description: One or more labels that indicate a specific
                              set of pods/VMs on which a policy should be applied.
                              The scope of label search is restricted to the configuration
                              namespace in which the resource is present.
                            type: object
                        type: object
                    type: object
                required:
                - metadata
                - spec
                type: object
            required:
            - dynamicPrinciples
            - template
            type: object
          status:
            description: DynamicAuthorizationPolicyStatus defines the observed state
              of DynamicAuthorizationPolicy
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
